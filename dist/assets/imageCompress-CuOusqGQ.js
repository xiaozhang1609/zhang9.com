import{c as R,r as c,j as e,I as U}from"./index-D9lornJ7.js";import{J as S}from"./jszip.min-BYLSP9Op.js";import{U as z}from"./upload-CMq6zEfF.js";import{D as k}from"./download-Bay_of4p.js";import{A as D}from"./alert-circle-DJt655b2.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const E=R("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);function A(){const[r,d]=c.useState([]),[m,p]=c.useState(!1),[u,x]=c.useState(null),[g,h]=c.useState(0),b=c.useRef(null),[n,f]=c.useState({format:"jpeg",compressionLevel:"medium"}),j=c.useCallback(s=>{const a=Array.from(s).filter(t=>t.type.startsWith("image/")).map(t=>({file:t,preview:URL.createObjectURL(t)}));if(a.reduce((t,{file:l})=>t+l.size,0)>50*1024*1024){x("总文件大小不能超过 50MB");return}x(null),d(t=>[...t,...a])},[]),y=c.useCallback(async s=>new Promise((a,t)=>{const l=new window.Image;l.src=s.preview,l.onload=()=>{const o=b.current,i=o.getContext("2d"),{scale:v,quality:L}={low:{scale:1,quality:.8},medium:{scale:.8,quality:.6},high:{scale:.6,quality:.4},ultra:{scale:.4,quality:.2}}[n.compressionLevel];o.width=l.width*v,o.height=l.height*v,i.imageSmoothingEnabled=!0,i.imageSmoothingQuality="high",i.drawImage(l,0,0,o.width,o.height),o.toBlob(N=>N?a(N):t("压缩失败"),`image/${n.format}`,L)},l.onerror=()=>t("图片加载失败")}),[n]),w=c.useCallback(async()=>{if(r.length!==0){p(!0),h(0),x(null);try{const s=[];for(let a=0;a<r.length;a++){const t=await y(r[a]);s.push({...r[a],compressed:{blob:t,ratio:Math.round(t.size/r[a].file.size*100)}}),h(Math.round((a+1)/r.length*100))}d(s)}catch(s){x(typeof s=="string"?s:"压缩过程中出现错误")}finally{p(!1),h(0)}}},[r,y]),C=c.useCallback(s=>{d(a=>{const t=[...a];return URL.revokeObjectURL(a[s].preview),t.splice(s,1),t})},[]),I=c.useCallback(async()=>{const s=r.filter(o=>o.compressed);if(s.length===0)return;const a=new S;s.forEach((o,i)=>{a.file(`compressed_${i+1}.${n.format}`,o.compressed.blob)});const t=await a.generateAsync({type:"blob"}),l=document.createElement("a");l.href=URL.createObjectURL(t),l.download="压缩后的图片.zip",l.click()},[r,n.format]);return e.jsxs("div",{className:"w-full max-w-5xl mx-auto p-4 md:p-6 space-y-6",children:[e.jsxs("div",{className:"card p-6 md:p-8",children:[e.jsxs("div",{className:"flex flex-col md:flex-row items-start md:items-center gap-6 mb-8 pb-6 border-b border-gray-100 dark:border-gray-800",children:[e.jsx("div",{className:"p-4 bg-gradient-to-br from-blue-500/10 to-cyan-500/10 dark:from-blue-500/20 dark:to-cyan-500/20 rounded-2xl",children:e.jsx(U,{className:"w-8 h-8 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold text-gray-900 dark:text-gray-50",children:"图片压缩工具"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mt-1.5 text-sm md:text-base",children:"支持批量压缩图片，可自定义压缩参数"})]})]}),e.jsxs("div",{className:"mb-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm mb-2",children:"压缩级别"}),e.jsx("div",{className:"grid grid-cols-4 gap-2",children:["low","medium","high","ultra"].map(s=>e.jsx("button",{onClick:()=>f(a=>({...a,compressionLevel:s})),className:`p-2 rounded-lg text-sm ${n.compressionLevel===s?"bg-blue-500 text-white":"bg-gray-100 dark:bg-gray-700"}`,children:{low:"轻度压缩",medium:"中度压缩",high:"高度压缩",ultra:"极限压缩"}[s]},s))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm mb-2",children:"输出格式"}),e.jsx("div",{className:"flex gap-4",children:["jpeg","png","webp"].map(s=>e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"radio",name:"format",value:s,checked:n.format===s,onChange:a=>f(t=>({...t,format:a.target.value})),className:"text-blue-600"}),e.jsx("span",{className:"uppercase text-sm",children:s})]},s))})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"border-2 border-dashed border-gray-300 dark:border-gray-700 rounded-xl p-8 text-center cursor-pointer hover:border-blue-500 dark:hover:border-blue-400 transition-colors",onDragOver:s=>s.preventDefault(),onDrop:s=>{s.preventDefault(),j(s.dataTransfer.files)},onClick:()=>{const s=document.createElement("input");s.type="file",s.accept="image/*",s.multiple=!0,s.onchange=a=>{const t=a.target.files;t&&j(t)},s.click()},children:[e.jsx(z,{className:"w-12 h-12 mx-auto mb-3 text-gray-400"}),e.jsxs("p",{className:"text-gray-600 dark:text-gray-400",children:["点击或拖拽上传图片",e.jsx("br",{}),e.jsx("span",{className:"text-sm text-gray-500",children:"支持批量上传，单次最大 50MB"})]})]}),r.length>0&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h2",{className:"text-lg font-medium",children:["已上传 ",r.length," 张图片"]}),e.jsx("button",{onClick:()=>d([]),className:"text-sm text-red-500 hover:text-red-600",children:"清空"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:r.map((s,a)=>e.jsxs("div",{className:"relative p-4 bg-gray-50 dark:bg-gray-800 rounded-xl",children:[e.jsx("button",{onClick:()=>C(a),className:"absolute top-2 right-2 p-1 bg-red-100 dark:bg-red-900/30 text-red-600 dark:text-red-400 rounded-lg hover:bg-red-200 dark:hover:bg-red-900/50",children:e.jsx(E,{className:"w-4 h-4"})}),e.jsx("img",{src:s.preview,alt:s.file.name,className:"w-full h-32 object-cover rounded-lg mb-2"}),e.jsx("div",{className:"text-sm text-gray-500 mb-2 truncate",children:s.file.name}),e.jsxs("div",{className:"text-sm",children:["原始大小：",(s.file.size/1024).toFixed(1),"KB",s.compressed&&e.jsxs(e.Fragment,{children:[e.jsx("br",{}),"压缩后：",(s.compressed.blob.size/1024).toFixed(1),"KB",e.jsx("br",{}),"压缩率：",s.compressed.ratio,"%"]})]})]},a))}),m&&g>0&&e.jsxs("div",{className:"mt-4",children:[e.jsx("div",{className:"h-2 bg-gray-200 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-blue-500 transition-all duration-300",style:{width:`${g}%`}})}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:["正在压缩: ",g,"%"]})]}),e.jsxs("div",{className:"flex gap-4 items-center",children:[e.jsxs("button",{onClick:w,disabled:m,className:"flex-1 h-12 flex items-center justify-center gap-2 bg-gradient-to-r from-blue-500 to-cyan-500 hover:from-blue-600 hover:to-cyan-600 text-white font-medium rounded-xl disabled:opacity-50 transition-all",children:[e.jsx(k,{className:"w-5 h-5"}),m?"压缩中...":"开始压缩"]}),r.length>1&&r.some(s=>s.compressed)&&e.jsxs("button",{onClick:I,disabled:m,className:"h-12 px-6 flex items-center justify-center gap-2 bg-gray-100 dark:bg-gray-800 hover:bg-gray-200 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300 font-medium rounded-xl disabled:opacity-50 transition-all",children:[e.jsx(k,{className:"w-5 h-5"}),"打包下载"]})]})]}),u&&e.jsxs("div",{className:"flex items-center gap-2 text-red-600 dark:text-red-400 mt-4",children:[e.jsx(D,{className:"w-5 h-5"}),e.jsx("span",{children:u})]})]})]}),e.jsx("canvas",{ref:b,className:"hidden"})]})}export{A as default};
